# abort script on any command that exits with a non zero value
set -e

PACKAGE_NAME=github.com/henderjm/redis-broker
PACKAGE_DIR=${HOME}/src/${PACKAGE_NAME}

mkdir -p $(dirname $PACKAGE_NAME)/ $PACKAGE_DIR

export GOROOT=$(readlink -nf /var/vcap/packages/go)
export GOPATH=$BOSH_INSTALL_TARGET:${PACKAGE_DIR}/Godeps/_workspace
export PATH=$GOROOT/bin:$PATH

BINARIES=( broker processmonitor agent backup restore configmigrator )
for BINARY in "${BINARIES[@]}"
do
  go install ${PACKAGE_NAME}/cmd/${BINARY}
done

# clean up source artifacts
# rm -rf ${BOSH_INSTALL_TARGET}/src ${BOSH_INSTALL_TARGET}/pkg
